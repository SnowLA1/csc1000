<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Rent.ie - Home</title>
    <link rel="stylesheet" href="style.css" />

    <!-- Leaflet -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
      #leafletMap {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <header class="topbar">
      <a class="brand" href="index.html"
        >ğŸ  <span>Rent<span class="dot">.ie</span></span></a
      >
      <nav class="nav" data-auth>
        <a href="listings.html">Listings</a>
        <a href="login.html">Login</a>
      </nav>
    </header>

    <main class="app">
      <aside class="sidebar">
        <!-- Search bar -->
        <div class="search-row">
          <input id="searchInput" placeholder="Street, area, keyword..." />
          <button id="searchBtn" type="button">Search</button>
        </div>

        <!-- Filters -->
        <div class="filter-block">
          <div>
            <label for="areaSelect">AREA IN DUBLIN</label>
            <select id="areaSelect">
              <option value="all">Anywhere</option>
              <option value="Dublin">Dublin (General)</option>
              <option value="Dublin 1">Dublin 1</option>
              <option value="Dublin 2">Dublin 2</option>
              <option value="Dublin 3">Dublin 3</option>
              <option value="Dublin 4">Dublin 4</option>
              <option value="Dublin 5">Dublin 5</option>
              <option value="Dublin 6">Dublin 6</option>
              <option value="Dublin 6W">Dublin 6W</option>
              <option value="Dublin 7">Dublin 7</option>
              <option value="Dublin 8">Dublin 8</option>
              <option value="Dublin 9">Dublin 9</option>
              <option value="Dublin 10">Dublin 10</option>
              <option value="Dublin 11">Dublin 11</option>
              <option value="Dublin 12">Dublin 12</option>
              <option value="Dublin 13">Dublin 13</option>
              <option value="Dublin 14">Dublin 14</option>
              <option value="Dublin 15">Dublin 15</option>
              <option value="Dublin 16">Dublin 16</option>
              <option value="Dublin 17">Dublin 17</option>
              <option value="Dublin 18">Dublin 18</option>
              <option value="Dublin 20">Dublin 20</option>
              <option value="Dublin 22">Dublin 22</option>
              <option value="Dublin 24">Dublin 24</option>
            </select>
          </div>

          <div>
            <label for="budgetSelect">MAX BUDGET (PER MONTH)</label>
            <select id="budgetSelect">
              <option value="any">Any budget</option>
              <option value="1000">Up to â‚¬1,000</option>
              <option value="1500">Up to â‚¬1,500</option>
              <option value="2000">Up to â‚¬2,000</option>
              <option value="2500">Up to â‚¬2,500</option>
              <option value="3000">Up to â‚¬3,000</option>
            </select>
          </div>
        </div>

        <!-- Types -->
        <div class="cat-row">
          <div class="cat active" data-type="all"><span>ğŸ˜ï¸</span>All</div>
          <div class="cat" data-type="room"><span>ğŸ›ï¸</span>Rooms</div>
          <div class="cat" data-type="studio"><span>ğŸ“¦</span>Studio</div>
          <div class="cat" data-type="apartment"><span>ğŸ¢</span>Apartments</div>
          <div class="cat" data-type="house"><span>ğŸ </span>Houses</div>
        </div>

        <div id="results" class="results"></div>
      </aside>

      <section class="map-wrap">
        <div id="leafletMap"></div>
      </section>
    </main>

    <footer class="footer">Rent.ie Content Copyright Â© 2025</footer>

    <script src="data.js"></script>
    <script src="app.js"></script>

    <script>
      let map;
      let listingMarkers = [];

      function clearListingMarkers() {
        listingMarkers.forEach((m) => m.remove());
        listingMarkers = [];
      }

      function houseIcon() {
        return L.divIcon({
          className: "house-marker",
          html: `<div class="house-pin">ğŸ </div>`,
          iconSize: [28, 28],
          iconAnchor: [14, 14],
          popupAnchor: [0, -12],
        });
      }

      function drawListingMarkers(list) {
        clearListingMarkers();

        list.forEach((l) => {
          if (typeof l.lat !== "number" || typeof l.lng !== "number") return;

          const marker = L.marker([l.lat, l.lng], {
            icon: houseIcon(),
          }).addTo(map);

          marker.bindPopup(`
            <strong>${l.title}</strong><br/>
            ${l.area}<br/>
            <button onclick="location.href='listing.html?id=${l.id}'"
              style="margin-top:6px;padding:6px 8px;border:0;border-radius:6px;background:#3f7fb7;color:#fff;font-size:12px;cursor:pointer;">
              Preview
            </button>
          `);

          listingMarkers.push(marker);
        });
      }

      function initLeaflet() {
        map = L.map("leafletMap", {
          zoomControl: true,
        }).setView([53.3498, -6.2603], 11);

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          maxZoom: 19,
          attribution: "&copy; OpenStreetMap",
        }).addTo(map);

        drawListingMarkers(window.LISTINGS);
      }

      function applyFiltersHome() {
        const q = (document.getElementById("searchInput")?.value || "").toLowerCase();
        const area = document.getElementById("areaSelect")?.value || "all";
        const maxBudgetVal = document.getElementById("budgetSelect")?.value || "any";
        const maxBudget = maxBudgetVal === "any" ? Infinity : Number(maxBudgetVal);
        const type = document.querySelector(".cat.active")?.dataset.type || "all";

        let filtered = window.LISTINGS.filter((l) => {
          const matchesQ = (l.title + " " + l.area).toLowerCase().includes(q);
          const matchesArea = area === "all" || l.area === area;
          const price =
            l.priceMonthly ?? (l.priceWeekly ? l.priceWeekly * 4.33 : Infinity);
          const matchesBudget = price <= maxBudget;
          const matchesType = type === "all" || l.type === type;

          return matchesQ && matchesArea && matchesBudget && matchesType;
        });

        if (typeof renderSidebar === "function") {
          renderSidebar(filtered);
        }

        drawListingMarkers(filtered);
      }

      // UI BINDINGS
      document.addEventListener("DOMContentLoaded", () => {
        initLeaflet();

        const area = document.getElementById("areaSelect");
        const budget = document.getElementById("budgetSelect");
        const search = document.getElementById("searchInput");
        const btn = document.getElementById("searchBtn");

        [area, budget].forEach(
          (el) => el && el.addEventListener("change", applyFiltersHome)
        );
        search && search.addEventListener("input", applyFiltersHome);
        btn && btn.addEventListener("click", applyFiltersHome);

        document.querySelectorAll(".cat").forEach((c) => {
          c.onclick = () => {
            document
              .querySelectorAll(".cat")
              .forEach((x) => x.classList.remove("active"));
            c.classList.add("active");
            applyFiltersHome();
          };
        });

        applyFiltersHome();
      });
    </script>
  </body>
</html>




